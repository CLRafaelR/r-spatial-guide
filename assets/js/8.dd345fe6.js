(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{151:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("p",[s._v("印刷や画面上での表示に向いた静的な地図の作成方法と、ウェブベースでのインタラクティブな操作が可能な空間データのマッピングについて学びます。")]),s._v(" "),a("p",[s._v("まず、Rの標準作図機能による地図の作成を行います。次にggplot2パッケージによる例を紹介します。")]),s._v(" "),a("p",[s._v("データ操作や処理を行うので、")]),s._v(" "),a("p",[s._v("前章を先に読んでいてください。")]),s._v(" "),a("p",[s._v("空間データは3次元構造を持っており、関心のある地物に近づくための拡大や、対して距離をとる縮小があります。")]),s._v(" "),a("h2",{attrs:{id:"利用するデータ、パッケージ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用するデータ、パッケージ","aria-hidden":"true"}},[s._v("#")]),s._v(" 利用するデータ、パッケージ")]),s._v(" "),a("p",[s._v("この章では")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("library"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sf"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dplyr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ggplot2"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("library"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpndistrict"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nsf_pref_33 "),a("span",{attrs:{class:"token operator"}},[s._v("<-")]),s._v(" \n  jpn_pref"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("33")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" district "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("TRUE")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("glimpse"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"base"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#base","aria-hidden":"true"}},[s._v("#")]),s._v(" base")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("sfオブジェクトに対して"),a("code",[s._v("plot()")]),s._v("を適用した場合、デフォルトでは全ての属性について作図を行います。")]),s._v(" "),a("p",[s._v("そのため、地物の形状あるいは特定の属性について確認したい際には次のようにします。"),a("code",[s._v("[")]),s._v("演算子で対象の属性を含む列を指定するか、"),a("code",[s._v("st_geometry()")]),s._v("を使います。")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("sf_pref_33 "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  st_geometry"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("col "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"white"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("code",[s._v("options(sf_max.plot =)")]),s._v("で描画される数を制御することも可能です。これによりセッションが終了するまで設定を維持できます。ただし、この設定が予期せぬ結果を招くこともあるので、描画対象は都度指定するようにした方が良いでしょう。")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("options"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sf_max.plot "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsf_pref_33 "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"hexmapr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hexmapr","aria-hidden":"true"}},[s._v("#")]),s._v(" hexmapr")]),s._v(" "),a("h2",{attrs:{id:"あれこれ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#あれこれ","aria-hidden":"true"}},[s._v("#")]),s._v(" あれこれ")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("library"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estatapi"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconf "),a("span",{attrs:{class:"token operator"}},[s._v("<-")]),s._v(" config"),a("span",{attrs:{class:"token operator"}},[s._v("::")]),s._v("get"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nd2 "),a("span",{attrs:{class:"token operator"}},[s._v("<-")]),s._v(" \n  estat_getStatsList"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("appId "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" conf"),a("span",{attrs:{class:"token operator"}},[s._v("$")]),s._v("estat_token"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                     searchWord "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"学校基本調査"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("# d2 %>%")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v('#   filter(stringr::str_detect(STATISTICS_NAME, "学校基本調査 平成２８年度 .+ 小学校"),')]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v('#          stringr::str_detect(TITLE, "指定都市等に所在する学校数"))')]),s._v("\n\ndf_school_child "),a("span",{attrs:{class:"token operator"}},[s._v("<-")]),s._v(" \n  estat_getStatsData"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("appId "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" conf"),a("span",{attrs:{class:"token operator"}},[s._v("$")]),s._v("estat_token"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                   statsDataId "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"0003180323"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ndf_school_child\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("# d <- ")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("#   estat_getDataCatalog(appId = conf$estat_token, ")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v('#                      searchWord = "学校基本調査")')]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("# d %>% ")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v('#   filter(stringr::str_detect(NAME, "指定都市等に所在する学校数"))')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("sf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"city"')]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("ここで日本語が文字化けする時には")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("par"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("family "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"IPAexGothic"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    oma "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("6.5")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    mar "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"city"')]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("凡例は標準で図の右側に配置されますが、これは"),a("code",[s._v("key.pos")]),s._v("引数で位置を調整できます。")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("sf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"city"')]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" \n  plot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key.pos "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('""')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"ggplot2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ggplot2","aria-hidden":"true"}},[s._v("#")]),s._v(" ggplot2")]),s._v(" "),a("div",{staticClass:"language-r line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-r"}},[a("code",[s._v("ggplot"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  geom_sf"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" sf_pref_33"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" aes"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fill "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" city_code"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 経緯度線を描画しない")]),s._v("\n  coord_sf"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("datum "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("NA")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  guides"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fill "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("FALSE")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 背景色を白にする")]),s._v("\n  theme_void"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"leafet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leafet","aria-hidden":"true"}},[s._v("#")]),s._v(" leafet")]),s._v(" "),a("h2",{attrs:{id:"deckgl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deckgl","aria-hidden":"true"}},[s._v("#")]),s._v(" deckgl")])])}],!1,null,null,null);e.options.__file="spatial-data-mapping.md";t.default=e.exports}}]);